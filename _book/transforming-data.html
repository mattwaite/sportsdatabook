<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Transforming data | Sports Data Analysis and Visualization for Journalists and Other Storytellers</title>
  <meta name="description" content="This book is the companion to the University of Nebraska-Lincoln’s SPMC 350 course in the College of Journalism and Mass Communications." />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Transforming data | Sports Data Analysis and Visualization for Journalists and Other Storytellers" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is the companion to the University of Nebraska-Lincoln’s SPMC 350 course in the College of Journalism and Mass Communications." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Transforming data | Sports Data Analysis and Visualization for Journalists and Other Storytellers" />
  
  <meta name="twitter:description" content="This book is the companion to the University of Nebraska-Lincoln’s SPMC 350 course in the College of Journalism and Mass Communications." />
  

<meta name="author" content="Matt Waite" />


<meta name="date" content="2019-07-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="filters-and-selections.html">
<link rel="next" href="simulations.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Sports Data Analysis and Visualization</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Throwing cold water on hot takes</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#requirements-and-conventions"><i class="fa fa-check"></i><b>1.1</b> Requirements and Conventions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Basics.html"><a href="Basics.html"><i class="fa fa-check"></i><b>2</b> The very basics</a><ul>
<li class="chapter" data-level="2.1" data-path="Basics.html"><a href="Basics.html#adding-libraries-part-1"><i class="fa fa-check"></i><b>2.1</b> Adding libraries, part 1</a></li>
<li class="chapter" data-level="2.2" data-path="Basics.html"><a href="Basics.html#adding-libraries-part-2"><i class="fa fa-check"></i><b>2.2</b> Adding libraries, part 2</a></li>
<li class="chapter" data-level="2.3" data-path="Basics.html"><a href="Basics.html#notebooks"><i class="fa fa-check"></i><b>2.3</b> Notebooks</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html"><i class="fa fa-check"></i><b>3</b> Data, structures and types</a><ul>
<li class="chapter" data-level="3.1" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html#rows-and-columns"><i class="fa fa-check"></i><b>3.1</b> Rows and columns</a></li>
<li class="chapter" data-level="3.2" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html#a-simple-way-to-get-data"><i class="fa fa-check"></i><b>3.2</b> A simple way to get data</a></li>
<li class="chapter" data-level="3.3" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html#cleaning-the-data"><i class="fa fa-check"></i><b>3.3</b> Cleaning the data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="aggregates.html"><a href="aggregates.html"><i class="fa fa-check"></i><b>4</b> Aggregates</a><ul>
<li class="chapter" data-level="4.1" data-path="aggregates.html"><a href="aggregates.html#basic-data-analysis-group-by-and-count"><i class="fa fa-check"></i><b>4.1</b> Basic data analysis: Group By and Count</a></li>
<li class="chapter" data-level="4.2" data-path="aggregates.html"><a href="aggregates.html#other-aggregates-mean-and-median"><i class="fa fa-check"></i><b>4.2</b> Other aggregates: Mean and median</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mutating-data.html"><a href="mutating-data.html"><i class="fa fa-check"></i><b>5</b> Mutating data</a><ul>
<li class="chapter" data-level="5.1" data-path="mutating-data.html"><a href="mutating-data.html#a-more-complex-example"><i class="fa fa-check"></i><b>5.1</b> A more complex example</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="filters-and-selections.html"><a href="filters-and-selections.html"><i class="fa fa-check"></i><b>6</b> Filters and selections</a><ul>
<li class="chapter" data-level="6.1" data-path="filters-and-selections.html"><a href="filters-and-selections.html#selecting-data-to-make-it-easier-to-read"><i class="fa fa-check"></i><b>6.1</b> Selecting data to make it easier to read</a></li>
<li class="chapter" data-level="6.2" data-path="filters-and-selections.html"><a href="filters-and-selections.html#using-conditional-filters-to-set-limits"><i class="fa fa-check"></i><b>6.2</b> Using conditional filters to set limits</a></li>
<li class="chapter" data-level="6.3" data-path="filters-and-selections.html"><a href="filters-and-selections.html#top-list"><i class="fa fa-check"></i><b>6.3</b> Top list</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="transforming-data.html"><a href="transforming-data.html"><i class="fa fa-check"></i><b>7</b> Transforming data</a><ul>
<li class="chapter" data-level="7.1" data-path="transforming-data.html"><a href="transforming-data.html#making-wide-data-long"><i class="fa fa-check"></i><b>7.1</b> Making wide data long</a></li>
<li class="chapter" data-level="7.2" data-path="transforming-data.html"><a href="transforming-data.html#why-this-matters"><i class="fa fa-check"></i><b>7.2</b> Why this matters</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="simulations.html"><a href="simulations.html"><i class="fa fa-check"></i><b>8</b> Simulations</a><ul>
<li class="chapter" data-level="8.1" data-path="simulations.html"><a href="simulations.html#cold-streaks"><i class="fa fa-check"></i><b>8.1</b> Cold streaks</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="correlations-and-regression.html"><a href="correlations-and-regression.html"><i class="fa fa-check"></i><b>9</b> Correlations and regression</a><ul>
<li class="chapter" data-level="9.1" data-path="correlations-and-regression.html"><a href="correlations-and-regression.html#a-more-predictive-example"><i class="fa fa-check"></i><b>9.1</b> A more predictive example</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="multiple-regression.html"><a href="multiple-regression.html"><i class="fa fa-check"></i><b>10</b> Multiple regression</a></li>
<li class="chapter" data-level="11" data-path="residuals.html"><a href="residuals.html"><i class="fa fa-check"></i><b>11</b> Residuals</a><ul>
<li class="chapter" data-level="11.1" data-path="residuals.html"><a href="residuals.html#penalties"><i class="fa fa-check"></i><b>11.1</b> Penalties</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="z-scores.html"><a href="z-scores.html"><i class="fa fa-check"></i><b>12</b> Z scores</a><ul>
<li class="chapter" data-level="12.1" data-path="z-scores.html"><a href="z-scores.html#calculating-a-z-score-in-r"><i class="fa fa-check"></i><b>12.1</b> Calculating a Z score in R</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html"><i class="fa fa-check"></i><b>13</b> Intro to ggplot</a><ul>
<li class="chapter" data-level="13.1" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html#scales"><i class="fa fa-check"></i><b>13.1</b> Scales</a></li>
<li class="chapter" data-level="13.2" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html#styling"><i class="fa fa-check"></i><b>13.2</b> Styling</a></li>
<li class="chapter" data-level="13.3" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html#one-last-trick-coord-flip"><i class="fa fa-check"></i><b>13.3</b> One last trick: coord flip</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="stacked-bar-charts.html"><a href="stacked-bar-charts.html"><i class="fa fa-check"></i><b>14</b> Stacked bar charts</a></li>
<li class="chapter" data-level="15" data-path="waffle-charts.html"><a href="waffle-charts.html"><i class="fa fa-check"></i><b>15</b> Waffle charts</a><ul>
<li class="chapter" data-level="15.1" data-path="waffle-charts.html"><a href="waffle-charts.html#waffle-irons"><i class="fa fa-check"></i><b>15.1</b> Waffle Irons</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="line-charts.html"><a href="line-charts.html"><i class="fa fa-check"></i><b>16</b> Line charts</a><ul>
<li class="chapter" data-level="16.1" data-path="line-charts.html"><a href="line-charts.html#but-what-if-i-wanted-to-add-a-lot-of-lines."><i class="fa fa-check"></i><b>16.1</b> But what if I wanted to add a lot of lines.</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="step-charts.html"><a href="step-charts.html"><i class="fa fa-check"></i><b>17</b> Step charts</a></li>
<li class="chapter" data-level="18" data-path="ridge-charts.html"><a href="ridge-charts.html"><i class="fa fa-check"></i><b>18</b> Ridge charts</a></li>
<li class="chapter" data-level="19" data-path="lollipop-charts.html"><a href="lollipop-charts.html"><i class="fa fa-check"></i><b>19</b> Lollipop charts</a></li>
<li class="chapter" data-level="20" data-path="scatterplots.html"><a href="scatterplots.html"><i class="fa fa-check"></i><b>20</b> Scatterplots</a></li>
<li class="chapter" data-level="21" data-path="facet-wraps.html"><a href="facet-wraps.html"><i class="fa fa-check"></i><b>21</b> Facet wraps</a><ul>
<li class="chapter" data-level="21.1" data-path="facet-wraps.html"><a href="facet-wraps.html#facet-grid-vs-facet-wraps"><i class="fa fa-check"></i><b>21.1</b> Facet grid vs facet wraps</a></li>
<li class="chapter" data-level="21.2" data-path="facet-wraps.html"><a href="facet-wraps.html#other-types"><i class="fa fa-check"></i><b>21.2</b> Other types</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>22</b> Tables</a><ul>
<li class="chapter" data-level="22.0.1" data-path="tables.html"><a href="tables.html#exporting-tables"><i class="fa fa-check"></i><b>22.0.1</b> Exporting tables</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="intro-to-rvest.html"><a href="intro-to-rvest.html"><i class="fa fa-check"></i><b>23</b> Intro to rvest</a><ul>
<li class="chapter" data-level="23.1" data-path="intro-to-rvest.html"><a href="intro-to-rvest.html#a-slightly-more-complicated-example"><i class="fa fa-check"></i><b>23.1</b> A slightly more complicated example</a></li>
<li class="chapter" data-level="23.2" data-path="intro-to-rvest.html"><a href="intro-to-rvest.html#an-even-more-complicated-example"><i class="fa fa-check"></i><b>23.2</b> An even more complicated example</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="advanced-rvest.html"><a href="advanced-rvest.html"><i class="fa fa-check"></i><b>24</b> Advanced rvest</a><ul>
<li class="chapter" data-level="24.1" data-path="advanced-rvest.html"><a href="advanced-rvest.html#one-last-bit"><i class="fa fa-check"></i><b>24.1</b> One last bit</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="annotations.html"><a href="annotations.html"><i class="fa fa-check"></i><b>25</b> Annotations</a></li>
<li class="chapter" data-level="26" data-path="finishing-touches-part-1.html"><a href="finishing-touches-part-1.html"><i class="fa fa-check"></i><b>26</b> Finishing touches, part 1</a><ul>
<li class="chapter" data-level="26.1" data-path="finishing-touches-part-1.html"><a href="finishing-touches-part-1.html#graphics-vs-visual-stories"><i class="fa fa-check"></i><b>26.1</b> Graphics vs visual stories</a></li>
<li class="chapter" data-level="26.2" data-path="finishing-touches-part-1.html"><a href="finishing-touches-part-1.html#getting-ggplot-closer-to-output"><i class="fa fa-check"></i><b>26.2</b> Getting ggplot closer to output</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="finishing-touches-2.html"><a href="finishing-touches-2.html"><i class="fa fa-check"></i><b>27</b> Finishing Touches 2</a></li>
<li class="chapter" data-level="28" data-path="assignments.html"><a href="assignments.html"><i class="fa fa-check"></i><b>28</b> Assignments</a><ul>
<li class="chapter" data-level="28.0.1" data-path="assignments.html"><a href="assignments.html#assignment"><i class="fa fa-check"></i><b>28.0.1</b> Assignment</a></li>
<li class="chapter" data-level="28.0.2" data-path="assignments.html"><a href="assignments.html#if-youre-curious-how-i-got-the-coaches-salaries-separated-out"><i class="fa fa-check"></i><b>28.0.2</b> If you’re curious how I got the coaches salaries separated out</a></li>
<li class="chapter" data-level="28.0.3" data-path="assignments.html"><a href="assignments.html#assignment-1"><i class="fa fa-check"></i><b>28.0.3</b> Assignment</a></li>
<li class="chapter" data-level="28.0.4" data-path="assignments.html"><a href="assignments.html#assignment-2"><i class="fa fa-check"></i><b>28.0.4</b> Assignment</a></li>
<li class="chapter" data-level="28.1" data-path="assignments.html"><a href="assignments.html#assignment-4"><i class="fa fa-check"></i><b>28.1</b> Assignment</a><ul>
<li class="chapter" data-level="28.1.1" data-path="assignments.html"><a href="assignments.html#assignment-5"><i class="fa fa-check"></i><b>28.1.1</b> Assignment</a></li>
<li class="chapter" data-level="28.1.2" data-path="assignments.html"><a href="assignments.html#assignment-6"><i class="fa fa-check"></i><b>28.1.2</b> Assignment</a></li>
<li class="chapter" data-level="28.1.3" data-path="assignments.html"><a href="assignments.html#assignment-7"><i class="fa fa-check"></i><b>28.1.3</b> Assignment</a></li>
<li class="chapter" data-level="28.1.4" data-path="assignments.html"><a href="assignments.html#assignment-8"><i class="fa fa-check"></i><b>28.1.4</b> Assignment</a></li>
<li class="chapter" data-level="28.1.5" data-path="assignments.html"><a href="assignments.html#assignment-9"><i class="fa fa-check"></i><b>28.1.5</b> Assignment</a></li>
<li class="chapter" data-level="28.1.6" data-path="assignments.html"><a href="assignments.html#assignment-12"><i class="fa fa-check"></i><b>28.1.6</b> Assignment</a></li>
<li class="chapter" data-level="28.1.7" data-path="assignments.html"><a href="assignments.html#assignment-14"><i class="fa fa-check"></i><b>28.1.7</b> Assignment</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Sports Data Analysis and Visualization for Journalists and Other Storytellers</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="transforming-data" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Transforming data</h1>
<p>Sometimes long data needs to be wide, and sometimes wide data needs to be long. I’ll explain.</p>
<p>You are soon going to discover that long before you can visualize data, you need to have it in a form that the visualization library can deal with. One of the ways that isn’t immediately obvious is how your data is cast. Most of the data you will encounter will be wide – each row will represent a single entity with multiple measures for that entity. So think of states. Your row of your dataset could have population, average life expectancy and other demographic data.</p>
<p>But what if your visualization library needs one row for each measure? That’s where recasting your data comes in. We can use a library called <code>tidyr</code> to <code>gather</code> or <code>spread</code> the data, depending on what we need.</p>
<p>We’ll use a dataset of college basketball games. First we need some libraries.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)</code></pre></div>
<p>Now we’ll grab the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logs &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/mattwaite/sportsdatabook/Master/data/logs19.csv&#39;</span>)</code></pre></div>
<pre><code>## Warning: Missing column names filled in: &#39;X1&#39; [1]</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   Date = col_date(format = &quot;&quot;),
##   HomeAway = col_character(),
##   Opponent = col_character(),
##   W_L = col_character(),
##   Blank = col_logical(),
##   Team = col_character(),
##   Conference = col_character(),
##   season = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<p>Last season, the Nebraska basketball team came out of the gates on fire. Their first 10 games were blistering. Their last 10? Not so much. But how can we compare a team’s first 10 games with their last 10 games? If you look, each game in the dataset is numbered, so getting the first 10 wouldn’t be hard. But what about the last five, when every team plays a different number of games?</p>
<p>To find that, we need to add some data to our table. And that is the maxiumum number of games a team played. So we’ll create a new dataframe where we’ll group our teams by team name and get the max game number for each team. Then, we’ll use something called a join, where we’ll connect the max games to the logs data using the common team name to connect them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">max &lt;-<span class="st"> </span>logs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Team) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">max_games =</span> <span class="kw">max</span>(Game))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logs &lt;-<span class="st"> </span>logs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(max)</code></pre></div>
<pre><code>## Joining, by = &quot;Team&quot;</code></pre>
<p>Now let’s just get Nebraska.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nebraska &lt;-<span class="st"> </span>logs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Team <span class="op">==</span><span class="st"> &quot;Nebraska Cornhuskers&quot;</span>)

<span class="kw">head</span>(nebraska)</code></pre></div>
<pre><code>## # A tibble: 6 x 45
##      X1  Game Date       HomeAway Opponent W_L   TeamScore OpponentScore
##   &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1  6449     1 2018-11-06 &lt;NA&gt;     Mississ… W           106            37
## 2  6450     2 2018-11-11 &lt;NA&gt;     Southea… W            87            35
## 3  6451     3 2018-11-14 &lt;NA&gt;     Seton H… W            80            57
## 4  6452     4 2018-11-19 N        Missour… W            85            62
## 5  6453     5 2018-11-20 N        Texas T… L            52            70
## 6  6454     6 2018-11-24 &lt;NA&gt;     Western… W            73            49
## # … with 37 more variables: TeamFG &lt;dbl&gt;, TeamFGA &lt;dbl&gt;, TeamFGPCT &lt;dbl&gt;,
## #   Team3P &lt;dbl&gt;, Team3PA &lt;dbl&gt;, Team3PPCT &lt;dbl&gt;, TeamFT &lt;dbl&gt;,
## #   TeamFTA &lt;dbl&gt;, TeamFTPCT &lt;dbl&gt;, TeamOffRebounds &lt;dbl&gt;,
## #   TeamTotalRebounds &lt;dbl&gt;, TeamAssists &lt;dbl&gt;, TeamSteals &lt;dbl&gt;,
## #   TeamBlocks &lt;dbl&gt;, TeamTurnovers &lt;dbl&gt;, TeamPersonalFouls &lt;dbl&gt;,
## #   Blank &lt;lgl&gt;, OpponentFG &lt;dbl&gt;, OpponentFGA &lt;dbl&gt;, OpponentFGPCT &lt;dbl&gt;,
## #   Opponent3P &lt;dbl&gt;, Opponent3PA &lt;dbl&gt;, Opponent3PPCT &lt;dbl&gt;,
## #   OpponentFT &lt;dbl&gt;, OpponentFTA &lt;dbl&gt;, OpponentFTPCT &lt;dbl&gt;,
## #   OpponentOffRebounds &lt;dbl&gt;, OpponentTotalRebounds &lt;dbl&gt;,
## #   OpponentAssists &lt;dbl&gt;, OpponentSteals &lt;dbl&gt;, OpponentBlocks &lt;dbl&gt;,
## #   OpponentTurnovers &lt;dbl&gt;, OpponentPersonalFouls &lt;dbl&gt;, Team &lt;chr&gt;,
## #   Conference &lt;chr&gt;, season &lt;chr&gt;, max_games &lt;dbl&gt;</code></pre>
<p>What we have here is long data. One row, one game. But what if we wanted to calculate the percent change in two variables? Say we wanted to see what the difference in shooting percentage has been between the first 10 games and the last ten Or the percent change in that? To get that, we’d need two fields next to each other so we could mutate our dataframe to calculate that, right? You’ll see the problem we have right away.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nebraska <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">grouping =</span> <span class="kw">case_when</span>(
    Game <span class="op">&lt;=</span><span class="dv">10</span> <span class="op">~</span><span class="st"> &quot;First 10&quot;</span>,
    Game <span class="op">&gt;=</span><span class="st"> </span>(max_games <span class="op">-</span><span class="st"> </span><span class="dv">10</span>) <span class="op">~</span><span class="st"> &quot;Last 10&quot;</span>)
    ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Team, grouping) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">shootingPCT =</span> <span class="kw">mean</span>(TeamFGPCT)
  )</code></pre></div>
<pre><code>## # A tibble: 3 x 3
## # Groups:   Team [1]
##   Team                 grouping shootingPCT
##   &lt;chr&gt;                &lt;chr&gt;          &lt;dbl&gt;
## 1 Nebraska Cornhuskers First 10       0.479
## 2 Nebraska Cornhuskers Last 10        0.422
## 3 Nebraska Cornhuskers &lt;NA&gt;           0.404</code></pre>
<p>How do you write a mutate step to calulate the percent change when they’re stacked on top of each other like that? Answer: You don’t. You have to move the data around.</p>
<p>To take long data and make it wide, we need to <code>spread</code> the data. That’s the new verb. To spread the data, we tell spread what the new columns will be and what the data values that will go with them. Spread does the rest.</p>
<p>So I’m going to take that same code and add spread to the bottom. I want the new columns to be my <code>grouping</code> and the data to be the <code>shootingPCT</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nebraska <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">grouping =</span> <span class="kw">case_when</span>(
    Game <span class="op">&lt;=</span><span class="dv">10</span> <span class="op">~</span><span class="st"> &quot;First 10&quot;</span>,
    Game <span class="op">&gt;=</span><span class="st"> </span>(max_games <span class="op">-</span><span class="st"> </span><span class="dv">10</span>) <span class="op">~</span><span class="st"> &quot;Last 10&quot;</span>)
    ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Team, grouping) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">shootingPCT =</span> <span class="kw">mean</span>(TeamFGPCT)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(grouping, shootingPCT) </code></pre></div>
<pre><code>## # A tibble: 1 x 4
## # Groups:   Team [1]
##   Team                 `First 10` `Last 10` `&lt;NA&gt;`
##   &lt;chr&gt;                     &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;
## 1 Nebraska Cornhuskers      0.479     0.422  0.404</code></pre>
<p>And now, with it spread out, I can chain another mutate step onto it, adding my difference and my percent change.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nebraska <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">grouping =</span> <span class="kw">case_when</span>(
    Game <span class="op">&lt;=</span><span class="dv">10</span> <span class="op">~</span><span class="st"> &quot;First 10&quot;</span>,
    Game <span class="op">&gt;=</span><span class="st"> </span>(max_games <span class="op">-</span><span class="st"> </span><span class="dv">10</span>) <span class="op">~</span><span class="st"> &quot;Last 10&quot;</span>)
    ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Team, grouping) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">shootingPCT =</span> <span class="kw">mean</span>(TeamFGPCT)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(grouping, shootingPCT) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">change =</span> ((<span class="st">`</span><span class="dt">Last 10</span><span class="st">`</span><span class="op">-</span><span class="st">`</span><span class="dt">First 10</span><span class="st">`</span>)<span class="op">/</span><span class="st">`</span><span class="dt">First 10</span><span class="st">`</span>)<span class="op">*</span><span class="dv">100</span>,
    <span class="dt">difference =</span> (<span class="st">`</span><span class="dt">First 10</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">Last 10</span><span class="st">`</span>)<span class="op">*</span><span class="dv">100</span>
    )</code></pre></div>
<pre><code>## # A tibble: 1 x 6
## # Groups:   Team [1]
##   Team                 `First 10` `Last 10` `&lt;NA&gt;` change difference
##   &lt;chr&gt;                     &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 Nebraska Cornhuskers      0.479     0.422  0.404  -12.0       5.73</code></pre>
<p>So, over Nebraska’s first 10 games, they shot almost 48 percent, where over the last ten horrid games they’re shooting 42 percent. That’s an 5.7 percentage point different or a nearly 12 percent drop from those first 10 games.</p>
<p>We can’t shoot the ball anymore.</p>
<p>How bad is that nationally? Just run the same code, but instead of Nebraska, use the logs dataframe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logs <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">grouping =</span> <span class="kw">case_when</span>(
    Game <span class="op">&lt;=</span><span class="dv">10</span> <span class="op">~</span><span class="st"> &quot;First 10&quot;</span>,
    Game <span class="op">&gt;=</span><span class="st"> </span>(max_games <span class="op">-</span><span class="st"> </span><span class="dv">10</span>) <span class="op">~</span><span class="st"> &quot;Last 10&quot;</span>)
    ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Team, grouping) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">shootingPCT =</span> <span class="kw">mean</span>(TeamFGPCT)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(grouping, shootingPCT) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">change =</span> ((<span class="st">`</span><span class="dt">Last 10</span><span class="st">`</span><span class="op">-</span><span class="st">`</span><span class="dt">First 10</span><span class="st">`</span>)<span class="op">/</span><span class="st">`</span><span class="dt">First 10</span><span class="st">`</span>)<span class="op">*</span><span class="dv">100</span>,
    <span class="dt">difference =</span> (<span class="st">`</span><span class="dt">First 10</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">Last 10</span><span class="st">`</span>)<span class="op">*</span><span class="dv">100</span>
    ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(change)</code></pre></div>
<pre><code>## # A tibble: 353 x 6
## # Groups:   Team [353]
##    Team                    `First 10` `Last 10` `&lt;NA&gt;` change difference
##    &lt;chr&gt;                        &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
##  1 North Texas Mean Green       0.484     0.391  0.439  -19.2       9.29
##  2 Miami (OH) RedHawks          0.465     0.379  0.424  -18.6       8.66
##  3 NC State Wolfpack            0.515     0.423  0.437  -18.0       9.29
##  4 Ohio State Buckeyes          0.477     0.392  0.441  -17.9       8.57
##  5 Vanderbilt Commodores        0.459     0.379  0.423  -17.5       8.02
##  6 Pacific Tigers               0.467     0.385  0.417  -17.4       8.13
##  7 Indiana Hoosiers             0.515     0.427  0.447  -17.2       8.89
##  8 UNC Greensboro Spartans      0.510     0.422  0.442  -17.2       8.78
##  9 Cincinnati Bearcats          0.474     0.394  0.432  -16.8       7.94
## 10 Seattle Redhawks             0.481     0.401  0.431  -16.6       8.00
## # … with 343 more rows</code></pre>
<p>In all of college basketball, Nebraska had the 40th biggest drop in shooting percentage from their first 10 games to their last 10 games.</p>
<p>And that’s a tiny portion of why Tim Miles is no longer the coach.</p>
<div id="making-wide-data-long" class="section level2">
<h2><span class="header-section-number">7.1</span> Making wide data long</h2>
<p>We can reverse this process as well. If we get data that’s wide and we want to make it long, we use <code>gather</code>. So first, since my data is already long, let me fake a wide dataset using what I just did.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gatherdata &lt;-<span class="st"> </span>nebraska <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">grouping =</span> <span class="kw">case_when</span>(
    Game <span class="op">&lt;=</span><span class="dv">10</span> <span class="op">~</span><span class="st"> &quot;First 10&quot;</span>,
    Game <span class="op">&gt;=</span><span class="st"> </span>(max_games <span class="op">-</span><span class="st"> </span><span class="dv">5</span>) <span class="op">~</span><span class="st"> &quot;Last 5&quot;</span>)
    ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Team, grouping) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">shootingPCT =</span> <span class="kw">mean</span>(TeamFGPCT)
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">spread</span>(grouping, shootingPCT)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(gatherdata)</code></pre></div>
<pre><code>## # A tibble: 1 x 4
## # Groups:   Team [1]
##   Team                 `First 10` `Last 5` `&lt;NA&gt;`
##   &lt;chr&gt;                     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
## 1 Nebraska Cornhuskers      0.479    0.444  0.402</code></pre>
<p>Oh drat, I have wide data and for a visualization project, I need long data. Whatever will I do? This might seem silly, but two assignments from now, you’re going to need long data from wide and wide data from long, so it’s good to know.</p>
<p>Gather, unfortunately, isn’t as easy as spread. It can take some fiddling to get right. There’s a ton of examples online if you Google for them, but here’s what you do: You tell <code>gather</code> what the new column of data you are creating out of the field names first – this is called the key – and you then tell it what the value field is going to be called, which is usually a number. Have more than one thing to name your stuff with? After your key value pair, add it with a negative sign in front of it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gatherdata <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(grouping, shootingPCT, <span class="op">-</span>Team)</code></pre></div>
<pre><code>## # A tibble: 3 x 3
## # Groups:   Team [1]
##   Team                 grouping shootingPCT
##   &lt;chr&gt;                &lt;chr&gt;          &lt;dbl&gt;
## 1 Nebraska Cornhuskers First 10       0.479
## 2 Nebraska Cornhuskers Last 5         0.444
## 3 Nebraska Cornhuskers &lt;NA&gt;           0.402</code></pre>
<p>And just like that, we’re back where we started.</p>
</div>
<div id="why-this-matters" class="section level2">
<h2><span class="header-section-number">7.2</span> Why this matters</h2>
<p>This matters because certain visualization types need wide or long data. A significant hurdle you will face for the rest of the semester is getting the data in the right format for what you want to do.</p>
<p>So let me walk you through an example using this data. If I asked you to describe Nebraska’s shooting performance over the season, we can do that by what we just did – grouping them into the first 10 games when people actually talked about this team in the Sweet 16 and the last five when we aren’t going to get an NIT bid. We can look at that shooting percentage, how it has changed, and that work makes for a perfect paragraph to write out. So to do that, you need wide data.</p>
<p>But to visualize it, you need long.</p>
<p>First, let’s load our charting library, <code>ggplot2</code> which you’re going to learn a lot more about soon.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)</code></pre></div>
<p>Now I’m going to use that data and put the date of the game on the x axis, the shooting percentage on the y axis and then, for giggles, I’m going to add a best fit line that describes our season using a simple regression and the equation of a line.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(nebraska, <span class="kw">aes</span>(<span class="dt">x=</span>Date, <span class="dt">y=</span>TeamFGPCT)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&#39;lm&#39;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>, <span class="dt">color=</span><span class="st">&quot;grey&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x=</span>(<span class="kw">as.Date</span>(<span class="st">&quot;2018-12-08&quot;</span>)), <span class="dt">y=</span><span class="fl">0.545</span>, <span class="dt">label=</span><span class="st">&quot;vs Creighton&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x=</span>(<span class="kw">as.Date</span>(<span class="st">&quot;2019-01-10&quot;</span>)), <span class="dt">y=</span><span class="fl">0.502</span>, <span class="dt">label=</span><span class="st">&quot;vs Penn State&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> W_L)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Date&quot;</span>, <span class="dt">y=</span><span class="st">&quot;FG percentage&quot;</span>, <span class="dt">title=</span><span class="st">&quot;Nebraska&#39;s season, visualized&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;As the season goes by, the Huskers are getting worse at shooting the ball.&quot;</span>, <span class="dt">caption=</span><span class="st">&quot;Source: NCAA | By Matt Waite&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;Outcome&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(
    <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),
    <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),
    <span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>(),
    <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>),
    <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),
    <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),
    <span class="dt">panel.grid.major.x =</span> <span class="kw">element_blank</span>(),
    <span class="dt">legend.position=</span><span class="st">&quot;bottom&quot;</span>
  )</code></pre></div>
<p><img src="SportsData_files/figure-html/unnamed-chunk-54-1.png" width="672" /> Oy. There it is. There’s our season.</p>
<p>So I can tell you now, using wide data, that Nebraska’s shooting performance over the last ten games is down 12 percent from the first 10 games. And using long data, I can show you the story of the season, but without any specific stats to back it up.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="filters-and-selections.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="simulations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["SportsData.pdf", "SportsData.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
